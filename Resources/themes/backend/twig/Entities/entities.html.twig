{% extends "Base/content_and_meta.html.twig" %}

{% block content %}

    <h1>Entities</h1>

    {% if app.session.hasFlash('error') %}
    <p class="alert alert-error">
        <button type="button" class="close" data-dismiss="alert">×</button>
        {{ app.session.flash('error') }}
    </p>
    {% endif %}
    {% if app.session.hasFlash('notice') %}
    <p class="alert">
        <button type="button" class="close" data-dismiss="alert">×</button>
        {{ app.session.flash('notice') }}
    </p>
    {% endif %}

    {% if app.session.hasFlash('debug') %}
    <pre>{{ app.session.flash('debug') }}</pre>
    {% endif %}

    <p>
        On this page you can add, edit and remove entities for your site.
    </p>

{% loadView 'Backend/findEntities' as entities %}
{% for entity in entities.result %}
    <h2>{{ entity.name }}</h2>

    {% if entity.delete is not defined %}
        <p>
        {% if entity.fixed %}
            This entity is only editable by hand.
        {% else %}
            This entity can be edited.
        {% endif %}
        </p>

        <div class="btn-group">
            <a class="btn btn-mini" href="{{ ref(['_entity/',entity.name]) }}">Edit entity</a>
            <a class="btn btn-mini btn-danger delete-entity-button" data-entity="{{ entity.name }}" href="{{ ref('_entities/all/mutate') }}">Delete entity</a>
        </div>
    {% else %}
        <p>
            <span class="alert alert-error">
                Entity has been deleted. Update your configuration to remove this message.
            </span>
        </p>
        <p>
            Please note this will only remove the YAML configuration. The model and entity code files will not be removed.
        </p>
    {% endif %}
{% endfor %}

    <h2>Add a new entity</h2>

    <button type="button" class="btn btn-primary add-entity-button">Add</button>


    <div class="hide">
        <div class="add-entity">
            <form class="add-entity-form" method="post" action="{{ ref('_entities/all/mutate') }}">
                <input type="hidden" name="action" value="add_entity" />
                <label>
                    Name:<br/>
                    <input type="text" class="correct-type" data-type="identifier" data-identifier-allow="uppercase" name="name" value="" />
                </label>
                <label>
                    Bundle:<br/>
                    {% loadView 'Backend/findBundles' as bundles %}
                    <select name="bundle">
                    {% for bundle in bundles.result %}
                        <option value="{{ bundle.value }}">{{ bundle.title }}</option>
                    {% endfor %}
                    </select>
                </label>
                <label>
                    Specify type:<br/>
                    {% loadView 'Backend/findPresetEntities' as presetentities %}
                    {% for presetentity in presetentities.result %}
                    <label>
                        <input type="radio" name="entity_type" value="{{ presetentity.value }}">
                        <span>{{ presetentity.title }}</span>
                    </label>
                    {% endfor %}
                </label>
            </form>
        </div>
    </div>

{% endblock %}
